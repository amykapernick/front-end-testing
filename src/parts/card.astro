---
import { Picture } from "@astrojs/image/components";
import PostExcerpt from "@igor.dvlpr/astro-post-excerpt";
import SVG from "./svg.astro";
import { parseISO, format } from "date-fns";

const {
	featured,
	external,
	title,
	date = new Date().toISOString(),
	slug,
	categories,
	type,
} = Astro.props.data;

const image = featured?.src
	? `/img/${featured.src}`
	: "/img/feature/placeholder.png";
---

<article class="post">
	<Picture
		src={image}
		alt=""
		formats={["avif", "webp", "jpg", "png"]}
		widths={[300, 600, 800]}
		aspectRatio="3:4"
	/>
	<h2>
		<a
			href={external ? external : `/${slug}`}
			target={external ? "_blank" : "_self"}
		>
			{
				external && (
					<>
						<span class="sr-only">External Link</span>
						<SVG name="icons/external.svg" />
					</>
				)
			}
			{type == "video" && <SVG name="icons/video.svg" />}
			{title}
		</a>
	</h2>
	<time datetime={format(parseISO(date), "yyyy-mm-dd")}>
		{format(parseISO(date), "dd MMM yyyy")}
	</time>
	<p class="excerpt">
		<PostExcerpt post={Astro.props.data} words={50} addEllipsis={true} />
	</p>
</article>
